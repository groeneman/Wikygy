{% extends "base.html" %}

{% block pagetitle %}
	Source Detail
{% endblock %}

{% block message %}
	{% if message %}
	{% if undoform %}
		<form action="{{undoaction}}" class="toolboxform" method="post" name="undo">{% csrf_token %}{{ undoform }}</form>
	{% endif %}
	<p>{{ message|safe }}{% if undoform %} <a href="javascript:document.undo.submit()">Undo</a></p>{% endif %}{% endif %}
{% endblock %}

{% block main %}
    <h1>{{source.title|safe}}</h1>
	{% if author %}
	<div class="author">By {{source.author}}</div>
	{% endif %}
	<p class="sourceURL">{{source.url}}</p>
	<form name="watchlist" action="{% url source_detail_action pk=source.id action='watch' %}" method='post' class="toolboxform">{% csrf_token %}{{toggleWatchList}}</form>
	
	<p class="metainfo">Added to Wikygy {{ source.dateAdded|timesince }} ago by {{ source.creator }}. {% if user.is_authenticated %}
		
		<a href="javascript:document.watchlist.submit()">{% if source in user.get_profile.watchlist.all %}Remove from Watchlist{% else %}Add to Watchlist{% endif %}</a>
	{% endif %}</p>
			<ul>{% for link in articles %}
					<li>
						{% if link.irr_cited_form %}
						<form class="toolboxform" name="irrelevant{{link.meta.pageid}}" action="{% url source_detail_action pk=source.id action='irrelevant' %}" method="POST">
							{% csrf_token %}
							{{ link.irr_cited_form }}
						</form>
						<form class="toolboxform" name="cited{{link.meta.pageid}}" action="{% url source_detail_action pk=source.id action='cite' %}" method="POST">
							{% csrf_token %}
							{{ link.irr_cited_form }}
						</form>
							{% if link.citation_undo %}
								<form class="toolboxform" name="undocitation{{link.meta.pageid}}" action="{% url source_detail_action pk=source.id action='cite' %}" method="POST">
									{% csrf_token %}
									{{ link.citation_undo }}
								</form>
							{% endif %}
						{% endif %}
						<a class="wikilink" href="{{link.meta.url }}">{{ link.meta }}</a>
							<span class ="toolbox">
								{% if not link.citation %}
									{% if link.irr_cited_form %}
										&ndash; (<a href="javascript:document.irrelevant{{link.meta.pageid}}.submit()">irrelevant</a>, <a href="javascript:document.cited{{link.meta.pageid}}.submit()">I cited this</a>)
									{% endif %}
								{% else %}
									 &ndash; (Cited by {{ link.citation.citer }} on {{ link.citation.dateCited }} {% if link.citation_undo %}<a href="javascript:document.undocitation{{link.meta.pageid}}.submit()">Undo</a>{% endif %})
								{% endif %}
								</span></li>
				{% endfor %}
			</ul>
			<a href="{% url source_list %}">View All</a>
{% endblock %}